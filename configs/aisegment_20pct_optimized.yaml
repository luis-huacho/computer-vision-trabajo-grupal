# Configuraci√≥n OPTIMIZADA para 20% del AISegment Dataset
# Dataset: ~6,800 im√°genes (20% de 34,425)
# Optimizado para GPU con 8GB+ VRAM libre
# Uso: python main.py train --config aisegment_20pct_optimized
#
# MEJORAS vs aisegment_10pct_lowmem:
# - Batch size 8 (mejor estad√≠sticas de Batch Norm)
# - Augmentaciones reactivadas (hue/sat y blur)
# - Loss weights optimizados para mejorar Recall
# - 50 epochs con early stopping patience 12
# - Learning rate ligeramente m√°s agresivo
#
# Objetivo: IoU 82-85% (vs 77.8% del 10% lowmem)

experiment:
  name: "AISegment 20% - Optimized (Batch 8)"
  description: "Entrenamiento con 20% del AISegment Dataset - Optimizado para IoU m√°ximo"
  mode: "production"

model:
  architecture: "resnet50"
  image_size: 384
  use_pretrained: true
  use_attention: true

dataset:
  type: "aisegment"
  root: "datasets/AISegment"

  # Descarga autom√°tica con kagglehub
  auto_download: true
  kaggle_dataset_id: "laurentmih/aisegmentcom-matting-human-datasets"

  # Split train/val
  train_val_split: 0.8

  # Usar 20% del dataset (~6,800 im√°genes)
  sampling:
    enabled: true
    mode: "percentage"
    percentage: 0.2      # 20% del dataset
    strategy: "random"
    random_seed: 42

training:
  num_epochs: 50       # ‚¨ÜÔ∏è Aumentado de 40 (m√°s tiempo para converger)
  batch_size: 8        # ‚¨ÜÔ∏è DUPLICADO de 4 a 8 (mejor Batch Norm stats)
  learning_rate: 0.00012  # ‚¨ÜÔ∏è Ligeramente m√°s agresivo (de 0.0001)
  weight_decay: 0.000001
  num_workers: 4       # ‚¨ÜÔ∏è Aumentado de 2 a 4 (mejor I/O)
  pin_memory: true
  drop_last: true
  gradient_clip_max_norm: 0.5
  mixed_precision: true  # ‚úÖ Mantener (ayuda con memoria)

  scheduler:
    type: "cosine_annealing"
    T_0: 10            # ‚¨ÜÔ∏è Aumentado de 7 (ciclos m√°s largos)
    T_mult: 2
    eta_min: 0.00001   # LR m√≠nimo para fine-tuning

  # üéØ LOSS WEIGHTS OPTIMIZADOS PARA MEJORAR RECALL
  loss_weights:
    alpha: 0.8         # ‚¨áÔ∏è Reducido de 1.0 (BCE menos dominante)
    beta: 1.2          # ‚¨ÜÔ∏è Aumentado de 1.0 (Dice m√°s importante - mejora overlap)
    gamma: 0.6         # ‚¨ÜÔ∏è Aumentado de 0.5 (Perceptual - calidad visual)
    delta: 0.4         # ‚¨ÜÔ∏è Aumentado de 0.3 (Edge - bordes precisos)

validation:
  frequency: 1
  early_stopping:
    enabled: true
    patience: 12       # ‚¨ÜÔ∏è Aumentado de 10 (m√°s paciencia con m√°s datos)
    min_delta: 0.0001
  target_metrics:
    iou: 0.85          # ‚¨ÜÔ∏è Target m√°s alto (de 0.83)
    dice: 0.90         # ‚¨ÜÔ∏è Target m√°s alto (de 0.88)
    pixel_accuracy: 0.95  # ‚¨ÜÔ∏è Target m√°s alto (de 0.93)

checkpoints:
  save_best: true
  save_last: true
  save_every_n_epochs: 5
  checkpoint_dir: "checkpoints/aisegment_20pct_optimized"

logging:
  log_every_n_batches: 15  # ‚¨áÔ∏è Reducido de 20 (m√°s info durante entrenamiento)
  save_plots: true

# üé® AUGMENTACIONES MEJORADAS (Estrategia Balanceada)
augmentation:
  train:
    # Augmentaciones geom√©tricas b√°sicas
    horizontal_flip: 0.5
    random_rotate90: 0.3    # ‚¨ÜÔ∏è Aumentado de 0.2

    shift_scale_rotate:
      enabled: true
      shift_limit: 0.1
      scale_limit: 0.2
      rotate_limit: 15
      p: 0.4               # ‚¨ÜÔ∏è Aumentado de 0.3

    # Augmentaciones de color
    brightness_contrast:
      enabled: true
      brightness_limit: 0.2
      contrast_limit: 0.2
      p: 0.4               # ‚¨ÜÔ∏è Aumentado de 0.3

    # üîÑ REACTIVADAS con probabilidad controlada
    hue_saturation_value:
      enabled: true        # ‚úÖ REACTIVADA (era false)
      hue_shift_limit: 10
      sat_shift_limit: 15
      val_shift_limit: 10
      p: 0.2               # Probabilidad conservadora

    gaussian_blur:
      enabled: true        # ‚úÖ REACTIVADA (era false)
      blur_limit: [3, 5]   # Blur sutil
      p: 0.15              # Probabilidad baja

# üìä MEJORAS ESPERADAS:
# - IoU actual (10% lowmem): 77.8%
# - IoU esperado (20% optimized): 82-85%
#   * +3-4% por duplicar datos (20% vs 10%)
#   * +1-2% por augmentaciones mejoradas
#   * +1-2% por loss weights optimizados (mejor recall)
#   * +0.5-1% por batch size mayor (mejor Batch Norm)
